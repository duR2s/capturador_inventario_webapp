<div class="dashboard-container">

  <!-- ==============================================
       VISTA 1: LISTA Y BOTONES (Se oculta si showForm es true)
       ============================================== -->
  <ng-container *ngIf="!showForm">

    <!-- Sección Acciones Rápidas -->
    <section class="dashboard-section fade-in-up" *ngIf="isAdmin">
      <h3 class="section-label">Gestión de Personal</h3>

      <div class="cards-grid">
        <app-boton-registro-usuarios
          tipo="EMPLEADO"
          (onClick)="abrirRegistro($event)">
        </app-boton-registro-usuarios>

        <app-boton-registro-usuarios
          tipo="ADMIN"
          (onClick)="abrirRegistro($event)">
        </app-boton-registro-usuarios>
      </div>
    </section>

    <!-- Sección Tabla -->
    <section class="table-section fade-in-up delay-100">
      <div class="loading-shade" *ngIf="isLoading">
        <mat-spinner diameter="40"></mat-spinner>
      </div>

      <app-tabla-usuarios
        *ngIf="!isLoading"
        [usuarios]="listaUsuarios"
        [_isAdmin]="isAdmin"
        (onEdit)="abrirEdicion($event)"
        (onDelete)="handleDelete($event)"
        (onChangeRole)="handleChangeRole($event)">
      </app-tabla-usuarios>
    </section>

  </ng-container>

  <!-- ==============================================
       VISTA 2: FORMULARIOS EMBEBIDOS (Se muestra si showForm es true)
       ============================================== -->
  <ng-container *ngIf="showForm">

    <!-- HEADER DE NAVEGACIÓN (NUEVO) -->
    <div class="form-navigation-header fade-in-up">
      <button mat-icon-button
              class="btn-back"
              (click)="cerrarFormulario(false)"
              matTooltip="Regresar a la lista">
        <mat-icon>arrow_back</mat-icon>
      </button>

      <div class="header-text">
        <h2 class="title">
          {{ userToEdit ? 'Editar' : 'Registrar' }}
          <span class="highlight">{{ formRole === 'ADMIN' ? 'Administrador' : 'Empleado' }}</span>
        </h2>
        <p class="subtitle">Complete la información solicitada a continuación</p>
      </div>
    </div>

    <!-- Formulario ADMIN -->
    <div *ngIf="formRole === 'ADMIN'" class="fade-in-up delay-100">
      <app-registro-admin
        [isEmbedded]="true"
        [datos_user]="userToEdit"
        (onClose)="cerrarFormulario($event)">
      </app-registro-admin>
    </div>

    <!-- Formulario EMPLEADO -->
    <div *ngIf="formRole === 'EMPLEADO'" class="fade-in-up delay-100">
      <app-registro-empleados
        [isEmbedded]="true"
        [datos_user]="userToEdit"
        (onClose)="cerrarFormulario($event)">
      </app-registro-empleados>
    </div>

  </ng-container>

</div>
