<!--
  CONTENEDOR PRINCIPAL
  Clase 'open' condicionada para animaciones CSS futuras.
-->
<div class="sidebar-container" [class.sidebar-open]="isOpen">

  <!--
    BOTÓN FLOTANTE (TOGGLE)
  -->
  <button class="toggle-btn" (click)="toggleMenu()">
    <mat-icon>{{ isOpen ? 'chevron_right' : 'chevron_left' }}</mat-icon>
  </button>

  <!--
    PANEL DE CONTENIDO
  -->
  <div class="info-panel" *ngIf="isOpen">

    <!-- CABECERA DEL PANEL -->
    <div class="panel-header">
      <h3 class="panel-title">Detalles de Sesión</h3>
      <span class="status-badge" [class.offline]="pendientesSincronizar > 0">
        {{ pendientesSincronizar > 0 ? 'Offline / Pendiente' : 'Sincronizado' }}
      </span>
    </div>

    <!-- DATOS GENERALES -->
    <div class="panel-body" *ngIf="captura">

      <div class="info-row">
        <label>Folio:</label>
        <span>{{ captura.folio }}</span>
      </div>

      <div class="info-row">
        <label>Almacén:</label>
        <span>{{ captura.almacen_nombre || 'Desconocido' }}</span>
      </div>

      <div class="info-row">
        <label>Capturador:</label>
        <span>{{ captura.capturador_nombre || 'Desconocido' }}</span>
      </div>

      <div class="info-row">
        <label>Fecha:</label>
        <span>{{ captura.fecha_captura | date:'short' }}</span>
      </div>

      <div class="metrics-row">
        <div class="metric-item">
          <span class="metric-value">{{ totalArticulos }}</span>
          <span class="metric-label">Escaneados</span>
        </div>
        <div class="metric-item warning" *ngIf="pendientesSincronizar > 0">
          <span class="metric-value">{{ pendientesSincronizar }}</span>
          <span class="metric-label">Pendientes</span>
        </div>
      </div>

    </div>

    <div class="panel-body empty-state" *ngIf="!captura">
      <p>No hay información de captura activa.</p>
    </div>

    <!-- ACCIONES -->
    <div class="panel-actions">

      <!-- NUEVO: Descargar Excel (Solo si NO es Borrador) -->
      <button class="action-btn btn-excel"
              *ngIf="captura && captura.estado !== 'BORRADOR'"
              (click)="ejecutarDescargarExcel()">
        <mat-icon>description</mat-icon>
        Descargar Excel
      </button>

      <!-- Sincronizar (Solo visible si hay pendientes) -->
      <button class="action-btn btn-sync"
              *ngIf="pendientesSincronizar > 0"
              (click)="ejecutarSincronizar()">
        <mat-icon>sync</mat-icon>
        Sincronizar
      </button>

      <!-- Terminar Captura -->
      <!-- Solo visible si está en Borrador para no terminarla dos veces (opcional) -->
      <button class="action-btn btn-finish"
              *ngIf="captura && captura.estado === 'BORRADOR'"
              (click)="ejecutarFinalizar()">
        <mat-icon>check_circle</mat-icon>
        Terminar
      </button>

      <!-- Eliminar Captura (Peligroso) -->
      <!-- MODIFICADO: Se deshabilita si NO es BORRADOR y el usuario NO es ADMIN -->
      <button class="action-btn btn-delete"
              (click)="ejecutarEliminar()"
              [class.disabled-icon]="captura.estado !== 'BORRADOR' && !isAdmin"
              [disabled]="captura.estado !== 'BORRADOR' && !isAdmin"
              *ngIf="captura.estado == 'BORRADOR' || isAdmin">
        <mat-icon>delete_forever</mat-icon>
        Eliminar Sesión
      </button>

    </div>

  </div>
</div>
